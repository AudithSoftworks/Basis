language: php

php:
  - 5.4
  - 5.5
  - 5.6
  - 7.0
  - hhvm

env:
  - DB=mysql
  - DB=pgsql

addons:
  postgresql: "9.3"

matrix:
  allow_failures:
    - php: 7.0
      env: DB=mysql
    - php: 7.0
      env: DB=pgsql
    - php: hhvm
      env: DB=pgsql
  fast_finish: true

sudo: true

before_install:
  - composer self-update
  - sudo apt-get update -qq
  - sudo apt-get install -y -qq sendmail

before_script:
  - if [[ "$DB" == "mysql" ]]; then mysql -e "CREATE DATABASE IF NOT EXISTS basis;" -uroot; fi
  - if [[ "$DB" == "pgsql" ]]; then psql -c "CREATE DATABASE basis;" -U postgres; fi

install: travis_retry composer install --no-interaction --prefer-source

script:
  - php artisan migrate --force
  - vendor/bin/phpunit

notifications:
  hipchat: f504f9e2e6696c17589a7b49f4ce05@Audith.Basis
