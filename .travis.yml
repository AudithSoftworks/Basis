language: php

php:
  - 5.4
  - 5.5
  - 5.6
  - 7.0
  - hhvm

env:
  - DB=mysql DB_USERNAME=root
  - DB=pgsql DB_USERNAME=postgres

addons:
  postgresql: "9.3"

matrix:
  fast_finish: true
  allow_failures:
    - php: 7.0
      env: DB=mysql DB_USERNAME=root
    - php: 7.0
      env: DB=pgsql DB_USERNAME=postgres
    - php: hhvm
      env: DB=pgsql DB_USERNAME=postgres
  fast_finish: true

sudo: true

before_install:
  - sudo apt-get update -qq
  - cp .env.example .env
  - node -v
  - npm -v
  - npm install -g npm@latest
  - npm install -g bower gulp
  - npm update -g
  - composer self-update
  - sudo apt-get install -y -qq sendmail

install:
  - travis_retry composer install --no-interaction --prefer-source
  - npm install
  - bower install

before_script:
  - if [[ "$DB" == "mysql" ]]; then mysql -e "CREATE DATABASE IF NOT EXISTS basis;" -uroot; fi
  - if [[ "$DB" == "pgsql" ]]; then psql -c "CREATE DATABASE basis;" -U postgres; fi
  - gulp

script:
  - php artisan migrate --force
  - vendor/bin/phpunit

notifications:
  hipchat: f504f9e2e6696c17589a7b49f4ce05@Audith.Basis
